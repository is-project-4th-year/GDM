{% extends 'base.html' %}

{% block title %}Diagnostic Report - GDM Predictor{% endblock %}

{% block extra_css %}
<style>
    .report-container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 2rem 0;
    }

    .report-header {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border-radius: 1rem;
        padding: 2rem;
        margin-bottom: 2rem;
        text-align: center;
    }

    .report-title {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .report-subtitle {
        opacity: 0.9;
        font-size: 1.125rem;
    }

    .report-actions {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
    }

    .btn-action {
        padding: 0.75rem 1.5rem;
        border-radius: 0.75rem;
        border: none;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        box-shadow: var(--shadow-md);
    }

    .btn-success {
        background: linear-gradient(135deg, var(--success), #059669);
        color: white;
    }

    .btn-secondary {
        background: var(--white);
        color: var(--gray-700);
        border: 2px solid var(--gray-300);
    }

    .btn-action:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
    }

    .report-content {
        background: var(--white);
        border-radius: 1rem;
        box-shadow: var(--shadow-lg);
        border: 1px solid var(--gray-200);
        overflow: hidden;
    }

    .report-section {
        padding: 2rem;
        border-bottom: 1px solid var(--gray-200);
    }

    .report-section:last-child {
        border-bottom: none;
    }

    .section-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--gray-800);
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .section-icon {
        width: 32px;
        height: 32px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 0.875rem;
    }

    .patient-summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .summary-item {
        text-align: center;
        padding: 1rem;
        background: var(--gray-50);
        border-radius: 0.75rem;
        border: 1px solid var(--gray-200);
    }

    .summary-label {
        font-size: 0.875rem;
        color: var(--gray-600);
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .summary-value {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--gray-800);
    }

    .risk-assessment {
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(6, 182, 212, 0.05));
        border-radius: 1rem;
        padding: 2rem;
        margin-bottom: 2rem;
        border: 2px solid var(--primary);
        text-align: center;
    }

    .risk-level {
        font-size: 3rem;
        font-weight: 700;
        margin-bottom: 1rem;
    }

    .risk-high {
        color: var(--error);
    }

    .risk-medium {
        color: var(--warning);
    }

    .risk-low {
        color: var(--success);
    }

    .risk-probability {
        font-size: 1.5rem;
        color: var(--gray-700);
        margin-bottom: 1rem;
    }

    .risk-description {
        font-size: 1rem;
        color: var(--gray-600);
        line-height: 1.6;
        max-width: 600px;
        margin: 0 auto;
    }

    .parameters-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
    }

    .parameter-card {
        background: var(--gray-50);
        border-radius: 0.75rem;
        padding: 1.5rem;
        border: 1px solid var(--gray-200);
        position: relative;
    }

    .parameter-name {
        font-size: 0.875rem;
        color: var(--gray-600);
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .parameter-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--gray-800);
        margin-bottom: 0.5rem;
    }

    .parameter-normal {
        font-size: 0.75rem;
        color: var(--gray-500);
    }

    .parameter-status {
        position: absolute;
        top: 1rem;
        right: 1rem;
        width: 12px;
        height: 12px;
        border-radius: 50%;
    }

    .status-normal {
        background: var(--success);
    }

    .status-elevated {
        background: var(--warning);
    }

    .status-high {
        background: var(--error);
    }

    .recommendations-list {
        list-style: none;
        padding: 0;
    }

    .recommendation-item {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        margin-bottom: 1.5rem;
        padding: 1rem;
        background: var(--gray-50);
        border-radius: 0.75rem;
        border-left: 4px solid var(--primary);
    }

    .recommendation-icon {
        width: 24px;
        height: 24px;
        background: var(--primary);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 0.75rem;
        flex-shrink: 0;
        margin-top: 0.125rem;
    }

    .recommendation-content {
        flex: 1;
    }

    .recommendation-title {
        font-weight: 600;
    }
    .recommendation-title {
        font-weight: 600;
        color: var(--gray-800);
        margin-bottom: 0.5rem;
    }

    .recommendation-text {
        color: var(--gray-700);
        line-height: 1.6;
    }

    .explainability-section {
        background: var(--gray-50);
        border-radius: 1rem;
        padding: 2rem;
        margin-bottom: 2rem;
    }

    .feature-importance {
        display: grid;
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .feature-bar {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: var(--white);
        border-radius: 0.75rem;
        border: 1px solid var(--gray-200);
    }

    .feature-name {
        min-width: 150px;
        font-weight: 600;
        color: var(--gray-800);
    }

    .feature-bar-container {
        flex: 1;
        height: 20px;
        background: var(--gray-200);
        border-radius: 10px;
        overflow: hidden;
        position: relative;
    }

    .feature-bar-fill {
        height: 100%;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        border-radius: 10px;
        transition: width 1s ease-in-out;
    }

    .feature-importance-value {
        min-width: 60px;
        text-align: right;
        font-weight: 600;
        color: var(--gray-800);
    }

    .comparison-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 2rem;
    }

    .comparison-table th,
    .comparison-table td {
        padding: 1rem;
        text-align: left;
        border-bottom: 1px solid var(--gray-200);
    }

    .comparison-table th {
        background: var(--gray-50);
        font-weight: 600;
        color: var(--gray-800);
    }

    .comparison-table tr:hover {
        background: var(--gray-50);
    }

    .timeline-summary {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding: 1rem;
        background: var(--gray-50);
        border-radius: 0.75rem;
        border: 1px solid var(--gray-200);
    }

    .timeline-item {
        text-align: center;
        flex: 1;
    }

    .timeline-date {
        font-size: 0.875rem;
        color: var(--gray-600);
        margin-bottom: 0.25rem;
    }

    .timeline-risk {
        font-weight: 600;
        font-size: 1.125rem;
    }

    .disclaimer {
        background: rgba(245, 158, 11, 0.1);
        border: 1px solid rgba(245, 158, 11, 0.3);
        border-radius: 1rem;
        padding: 1.5rem;
        margin-top: 2rem;
    }

    .disclaimer-title {
        font-weight: 600;
        color: var(--warning);
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .disclaimer-text {
        color: #92400e;
        font-size: 0.875rem;
        line-height: 1.6;
    }

    .report-footer {
        text-align: center;
        padding: 2rem;
        background: var(--gray-50);
        color: var(--gray-600);
        font-size: 0.875rem;
    }

    @media print {
        .report-actions {
            display: none !important;
        }
        
        .report-container {
            max-width: none;
            margin: 0;
            padding: 0;
        }
        
        .report-content {
            box-shadow: none;
            border: none;
        }
        
        .section-icon {
            print-color-adjust: exact;
            -webkit-print-color-adjust: exact;
        }
    }

    @media (max-width: 768px) {
        .report-actions {
            flex-direction: column;
        }

        .patient-summary {
            grid-template-columns: repeat(2, 1fr);
        }

        .parameters-grid {
            grid-template-columns: 1fr;
        }

        .timeline-summary {
            flex-direction: column;
            gap: 1rem;
        }

        .comparison-table {
            font-size: 0.875rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="report-container">
    <!-- Report Header -->
    <div class="report-header">
        <h1 class="report-title">GDM Risk Assessment Report</h1>
        <p class="report-subtitle">Comprehensive diagnostic analysis and clinical recommendations</p>
    </div>

    <!-- Report Actions -->
    <div class="report-actions">
        <button class="btn-action btn-primary" onclick="window.print()">
            <i class="fas fa-print"></i>
            Print Report
        </button>
        <button class="btn-action btn-success" onclick="downloadPDF()">
            <i class="fas fa-file-pdf"></i>
            Download PDF
        </button>
        <button class="btn-action btn-secondary" onclick="emailReport()">
            <i class="fas fa-envelope"></i>
            Email Report
        </button>
        <a href="{{ url_for('patient_management') }}" class="btn-action btn-secondary">
            <i class="fas fa-arrow-left"></i>
            Back to Patients
        </a>
    </div>

    <!-- Report Content -->
    <div class="report-content">
        <!-- Patient Information -->
        <div class="report-section">
            <h2 class="section-title">
                <div class="section-icon">
                    <i class="fas fa-user"></i>
                </div>
                Patient Information
            </h2>
            
            <div class="patient-summary">
                <div class="summary-item">
                    <div class="summary-label">Patient Name</div>
                    <div class="summary-value">Sarah Johnson</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Patient ID</div>
                    <div class="summary-value">P001</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Age</div>
                    <div class="summary-value">32 years</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Gestational Age</div>
                    <div class="summary-value">24 weeks</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Assessment Date</div>
                    <div class="summary-value">Nov 5, 2025</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Healthcare Provider</div>
                    <div class="summary-value">Dr. Jane Smith</div>
                </div>
            </div>
        </div>

        <!-- Risk Assessment Results -->
        <div class="report-section">
            <h2 class="section-title">
                <div class="section-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                Risk Assessment Results
            </h2>
            
            <div class="risk-assessment">
                <div class="risk-level risk-high">HIGH RISK</div>
                <div class="risk-probability">78% Probability of GDM</div>
                <div class="risk-description">
                    The AI model indicates a high probability of gestational diabetes mellitus development based on current clinical parameters. 
                    This assessment considers multiple risk factors including elevated BMI, blood pressure readings, family history, and laboratory values.
                </div>
            </div>

            <!-- Risk Trend -->
            <div class="timeline-summary">
                <div class="timeline-item">
                    <div class="timeline-date">Oct 21</div>
                    <div class="timeline-risk" style="color: var(--warning);">58% Medium</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-date">Oct 28</div>
                    <div class="timeline-risk" style="color: var(--warning);">63% Medium</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-date">Nov 3</div>
                    <div class="timeline-risk" style="color: var(--error);">78% High</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-date">Today</div>
                    <div class="timeline-risk" style="color: var(--error);">78% High</div>
                </div>
            </div>
        </div>

        <!-- Clinical Parameters -->
        <div class="report-section">
            <h2 class="section-title">
                <div class="section-icon">
                    <i class="fas fa-clipboard-list"></i>
                </div>
                Clinical Parameters
            </h2>
            
            <div class="parameters-grid">
                <div class="parameter-card">
                    <div class="parameter-status status-elevated"></div>
                    <div class="parameter-name">Body Mass Index</div>
                    <div class="parameter-value">31.2 kg/m²</div>
                    <div class="parameter-normal">Normal: 18.5-24.9 kg/m²</div>
                </div>
                
                <div class="parameter-card">
                    <div class="parameter-status status-elevated"></div>
                    <div class="parameter-name">Systolic Blood Pressure</div>
                    <div class="parameter-value">135 mmHg</div>
                    <div class="parameter-normal">Normal: &lt;120 mmHg</div>
                </div>
                
                <div class="parameter-card">
                    <div class="parameter-status status-elevated"></div>
                    <div class="parameter-name">Diastolic Blood Pressure</div>
                    <div class="parameter-value">88 mmHg</div>
                    <div class="parameter-normal">Normal: &lt;80 mmHg</div>
                </div>
                
                <div class="parameter-card">
                    <div class="parameter-status status-elevated"></div>
                    <div class="parameter-name">HDL Cholesterol</div>
                    <div class="parameter-value">42 mg/dL</div>
                    <div class="parameter-normal">Normal: &gt;50 mg/dL</div>
                </div>
                
                <div class="parameter-card">
                    <div class="parameter-status status-elevated"></div>
                    <div class="parameter-name">Hemoglobin</div>
                    <div class="parameter-value">11.8 g/dL</div>
                    <div class="parameter-normal">Normal: 12.0-16.0 g/dL</div>
                </div>
                
                <div class="parameter-card">
                    <div class="parameter-status status-normal"></div>
                    <div class="parameter-name">Age</div>
                    <div class="parameter-value">32 years</div>
                    <div class="parameter-normal">Risk increases with age</div>
                </div>
            </div>
        </div>

        <!-- AI Model Explainability -->
        <div class="report-section">
            <h2 class="section-title">
                <div class="section-icon">
                    <i class="fas fa-brain"></i>
                </div>
                AI Model Explainability
            </h2>
            
            <div class="explainability-section">
                <p style="margin-bottom: 2rem; color: var(--gray-700);">
                    The following chart shows how much each factor contributed to the final risk assessment:
                </p>
                
                <div class="feature-importance">
                    <div class="feature-bar">
                        <div class="feature-name">BMI (31.2)</div>
                        <div class="feature-bar-container">
                            <div class="feature-bar-fill" style="width: 85%;"></div>
                        </div>
                        <div class="feature-importance-value">85%</div>
                    </div>
                    
                    <div class="feature-bar">
                        <div class="feature-name">Systolic BP (135)</div>
                        <div class="feature-bar-container">
                            <div class="feature-bar-fill" style="width: 72%;"></div>
                        </div>
                        <div class="feature-importance-value">72%</div>
                    </div>
                    
                    <div class="feature-bar">
                        <div class="feature-name">Age (32)</div>
                        <div class="feature-bar-container">
                            <div class="feature-bar-fill" style="width: 68%;"></div>
                        </div>
                        <div class="feature-importance-value">68%</div>
                    </div>
                    
                    <div class="feature-bar">
                        <div class="feature-name">Diastolic BP (88)</div>
                        <div class="feature-bar-container">
                            <div class="feature-bar-fill" style="width: 65%;"></div>
                        </div>
                        <div class="feature-importance-value">65%</div>
                    </div>
                    
                    <div class="feature-bar">
                        <div class="feature-name">HDL (42)</div>
                        <div class="feature-bar-container">
                            <div class="feature-bar-fill" style="width: 58%;"></div>
                        </div>
                        <div class="feature-importance-value">58%</div>
                    </div>
                    
                    <div class="feature-bar">
                        <div class="feature-name">Family History</div>
                        <div class="feature-bar-container">
                            <div class="feature-bar-fill" style="width: 45%;"></div>
                        </div>
                        <div class="feature-importance-value">45%</div>
                    </div>
                    
                    <div class="feature-bar">
                        <div class="feature-name">Hemoglobin (11.8)</div>
                        <div class="feature-bar-container">
                            <div class="feature-bar-fill" style="width: 42%;"></div>
                        </div>
                        <div class="feature-importance-value">42%</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Clinical Recommendations -->
        <div class="report-section">
            <h2 class="section-title">
                <div class="section-icon">
                    <i class="fas fa-stethoscope"></i>
                </div>
                Clinical Recommendations
            </h2>
            
            <ul class="recommendations-list">
                <li class="recommendation-item">
                    <div class="recommendation-icon">
                        <i class="fas fa-user-md"></i>
                    </div>
                    <div class="recommendation-content">
                        <div class="recommendation-title">Immediate Specialist Consultation</div>
                        <div class="recommendation-text">
                            Schedule urgent appointment with maternal-fetal medicine specialist or endocrinologist for comprehensive GDM evaluation and management planning.
                        </div>
                    </div>
                </li>
                
                <li class="recommendation-item">
                    <div class="recommendation-icon">
                        <i class="fas fa-vial"></i>
                    </div>
                    <div class="recommendation-content">
                        <div class="recommendation-title">Oral Glucose Tolerance Test (OGTT)</div>
                        <div class="recommendation-text">
                            Perform 75g OGTT to confirm GDM diagnosis and assess glucose metabolism. Schedule within 1-2 weeks.
                        </div>
                    </div>
                </li>
                
                <li class="recommendation-item">
                    <div class="recommendation-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="recommendation-content">
                        <div class="recommendation-title">Blood Glucose Monitoring</div>
                        <div class="recommendation-text">
                            Initiate home blood glucose monitoring 4 times daily (fasting and 2-hour post-meal) to track glucose patterns.
                        </div>
                    </div>
                </li>
                
                <li class="recommendation-item">
                    <div class="recommendation-icon">
                        <i class="fas fa-utensils"></i>
                    </div>
                    <div class="recommendation-content">
                        <div class="recommendation-title">Nutritional Counseling</div>
                        <div class="recommendation-text">
                            Refer to registered dietitian for personalized meal planning, carbohydrate counting, and dietary modification strategies.
                        </div>
                    </div>
                </li>
                
                <li class="recommendation-item">
                    <div class="recommendation-icon">
                        <i class="fas fa-heartbeat"></i>
                    </div>
                    <div class="recommendation-content">
                        <div class="recommendation-title">Blood Pressure Management</div>
                        <div class="recommendation-text">
                            Monitor blood pressure closely. Consider antihypertensive therapy if persistently elevated. Target &lt;140/90 mmHg in pregnancy.
                        </div>
                    </div>
                </li>
                
                <li class="recommendation-item">
                    <div class="recommendation-icon">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="recommendation-content">
                        <div class="recommendation-title">Increased Monitoring Frequency</div>
                        <div class="recommendation-text">
                            Schedule biweekly appointments for close maternal and fetal surveillance. Include NST and growth scans as indicated.
                        </div>
                    </div>
                </li>
            </ul>
        </div>

        <!-- Historical Comparison -->
        <div class="report-section">
            <h2 class="section-title">
                <div class="section-icon">
                    <i class="fas fa-history"></i>
                </div>
                Historical Comparison
            </h2>
            
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Oct 21</th>
                        <th>Oct 28</th>
                        <th>Nov 3</th>
                        <th>Today</th>
                        <th>Trend</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Risk Probability</strong></td>
                        <td>58%</td>
                        <td>63%</td>
                        <td>78%</td>
                        <td>78%</td>
                        <td style="color: var(--error);"><i class="fas fa-arrow-up"></i> Increasing</td>
                    </tr>
                    <tr>
                        <td><strong>BMI (kg/m²)</strong></td>
                        <td>30.5</td>
                        <td>30.8</td>
                        <td>31.2</td>
                        <td>31.2</td>
                        <td style="color: var(--error);"><i class="fas fa-arrow-up"></i> Increasing</td>
                    </tr>
                    <tr>
                        <td><strong>Systolic BP (mmHg)</strong></td>
                        <td>125</td>
                        <td>128</td>
                        <td>135</td>
                        <td>135</td>
                        <td style="color: var(--error);"><i class="fas fa-arrow-up"></i> Increasing</td>
                    </tr>
                    <tr>
                        <td><strong>Diastolic BP (mmHg)</strong></td>
                        <td>78</td>
                        <td>82</td>
                        <td>88</td>
                        <td>88</td>
                        <td style="color: var(--error);"><i class="fas fa-arrow-up"></i> Increasing</td>
                    </tr>
                    <tr>
                        <td><strong>HDL (mg/dL)</strong></td>
                        <td>48</td>
                        <td>45</td>
                        <td>42</td>
                        <td>42</td>
                        <td style="color: var(--error);"><i class="fas fa-arrow-down"></i> Decreasing</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Medical Disclaimer -->
        <div class="disclaimer">
            <div class="disclaimer-title">
                <i class="fas fa-exclamation-triangle"></i>
                Important Medical Disclaimer
            </div>
            <div class="disclaimer-text">
                This AI-generated risk assessment is a clinical decision support tool and should not replace professional medical judgment. 
                The prediction is based on current clinical parameters and population-based models. Individual patient factors, 
                clinical presentation, and physician expertise must be considered in all diagnostic and treatment decisions. 
                This report should be used in conjunction with standard clinical protocols and guidelines for GDM management.
            </div>
        </div>

        <!-- Report Footer -->
        <div class="report-footer">
            <p>
                Generated by GDM Predictor AI System v2.1.0<br>
                Report ID: RPT-20251105-P001-001<br>
                Generated on: November 5, 2025 at 2:30 PM<br>
                Healthcare Facility: Strathmore University Medical Center
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Report actions
    function downloadPDF() {
        showToast('Generating PDF report...', 'info');
        // Implement PDF generation
        setTimeout(() => {
            showToast('PDF downloaded successfully!', 'success');
        }, 2000);
    }

    function emailReport() {
        const email = prompt('Enter email address to send report:');
        if (email && email.includes('@')) {
            showToast(`Sending report to ${email}...`, 'info');
            setTimeout(() => {
                showToast('Report sent successfully!', 'success');
            }, 2000);
        } else if (email) {
            showToast('Please enter a valid email address', 'error');
        }
    }

    // Animate feature importance bars on load
    document.addEventListener('DOMContentLoaded', function() {
        const bars = document.querySelectorAll('.feature-bar-fill');
        bars.forEach((bar, index) => {
            const finalWidth = bar.style.width;
            bar.style.width = '0%';
            setTimeout(() => {
                bar.style.width = finalWidth;
            }, 500 + (index * 100));
        });
        
        showToast('Diagnostic report generated', 'success');
    });
</script>
{% endblock %}